<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Scratch Auto Upload</title>
<style>
body { font-family: sans-serif; padding: 20px; }
#search-bar { width: 300px; padding: 5px; }
#song-grid { display: flex; flex-wrap: wrap; margin-top: 20px; gap: 10px; }
.song-card { width: 120px; cursor: pointer; text-align: center; border: 1px solid #ccc; padding: 5px; border-radius: 5px; }
.song-card img { width: 100px; height: 100px; object-fit: cover; border-radius: 5px; }
.song-name { font-size: 12px; font-weight: bold; margin-top: 5px; }
.artist-name { font-size: 11px; color: gray; }
</style>
</head>
<body>

<h2>Scratch Auto Upload</h2>

<input type="text" id="search-bar" placeholder="Search songs or artists">
<button onclick="searchSongs()">Search</button>

<div id="song-grid"></div>
<div id="link"></div>

<script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>

<script>
// Search songs using iTunes API
async function searchSongs() {
    const term = document.getElementById("search-bar").value;
    if(!term) return;
    const res = await fetch(`https://itunes.apple.com/search?term=${encodeURIComponent(term)}&media=music&limit=20`);
    const data = await res.json();

    const grid = document.getElementById("song-grid");
    grid.innerHTML = "";

    data.results.forEach(song => {
        if(!song.previewUrl || !song.artworkUrl100) return;
        const card = document.createElement("div");
        card.className = "song-card";
        card.innerHTML = `
            <img src="${song.artworkUrl100}" />
            <div class="song-name">${song.trackName}</div>
            <div class="artist-name">${song.artistName}</div>
        `;
        card.onclick = () => sendToBackend(song.previewUrl, song.artworkUrl100, song.trackName);
        grid.appendChild(card);
    });
}

// Send song info to Python backend
async function sendToBackend(audioUrl, coverUrl, songName){
    try {
        const res = await fetch("http://YOUR_SERVER_IP:5000/upload", {
            method: "POST",
            headers: {"Content-Type": "application/json"},
            body: JSON.stringify({audio_url: audioUrl, cover_url: coverUrl, song_name: songName})
        });
        const data = await res.json();
        if(data.project_url){
            document.getElementById("link").innerHTML = `<a href="${data.project_url}" target="_blank">View on Scratch</a>`;
        } else {
            alert("Error: " + data.error);
        }
    } catch(e){
        console.error(e);
        alert("Error: " + e);
    }
}
</script>

</body>
</html>
